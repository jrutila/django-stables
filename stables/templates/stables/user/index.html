{% extends "base.html" %}
{% load i18n stablestags %}
{% block content %}
<div class="widget">
    <div class="widget-content">

<h1>
    <span
        {% if object.inactive %}style="text-decoration:line-through"{% endif %}
    >{{ object }}
        {% if perms.auth.edit_user %}
        &nbsp;<a href="{% url "edit_user" object.user %}"><i class="fa fa-edit"></i></a>
        {% endif %}
    </span>
    {% ifnotequal object.customer object.rider.customer %}
    <small>
    (<a href="{{ object.rider.customer.user.get_absolute_url }}">{{ object.rider.customer.user }}</a>)
    </small>
    {% endifnotequal %}
</h1>

{% if object.instructor %}
<p>
{% trans "Instructor" %}
</p>
{% endif %}

<p>
{% trans "E-mail" %}: {{ object.user.email }}
</p>
<p>
{% trans "phone number"|capfirst %}: {{ object.phone_number }}
</p>

{% if object.next and object.next.count > 0 %}
<h3>
  {% trans "Next event" %}
</h3>
  <ul>
  {% for p in object.next %}
    <li>
        {% include "stables/user/_participation_partial.html" with p=p%}
    </li>
  {% endfor %}
  <li><a href="{{ request.path }}?tmore={{ object.next|length|add:2 }}">{% trans "More..." %}</a></li>
</ul>
{% endif %}

{% if object.participations %}
  <h3>
    {% trans "Previous participations" %}
  </h3>
  <ul>
    {% for p in object.participations %}
    <li>
        {% include "stables/user/_participation_partial.html" with p=p%}
    </li>
    {% endfor %}
    <li><a href="{{ request.path }}?pmore={{ object.participations|length|add:10 }}">{% trans "More..." %}</a></li>
  </ul>
{% endif %}

<h3>{% trans "Saldo and tickets" %}</h3>
{% if perms.stables.add_ticket %}
<a href="{% url "add_tickets" username=object.user.username %}">{% trans "Add tickets" %}</a>
<a href="{% url "edit_tickets" username=object.user.username %}">{% trans "Edit tickets" %}</a>
{% endif %}
{{ object.saldo }}
<ul>
{% for t, l in object.tickets.iteritems %}
<li class="ticket_valid">
{% blocktrans with name=t amount=l.0 expire_date=l.1 %}
{{ name }}: {{ amount }} pcs (first expires: {{ expire_date }})
{% endblocktrans %}
</li>
{% endfor %}
{% for t, l in object.expired_tickets.iteritems %}
<li class="ticket_expired">
{% blocktrans with name=t amount=l.0 expire_date=l.1 %}
Expired {{ name }}: {{ amount }} pcs (first expired: {{ expire_date }})
{% endblocktrans %}
</li>
{% endfor %}
</ul>

<h3>{% trans "Orders" %}</h3>
    <table class="table">
    <thead>
    <th>{% trans "Id" %}</th>
    <th>{% trans "Created" %}</th>
    <th>{% trans "Status" %}</th>
    <th>{% trans "Product" %}</th>
    <th>{% trans "Total" %}</th>
    </thead>
    <tbody>
    {% for o in object.orders %}
        <td>{{ o.order.id }}</td>
        <td>{{ o.order.created }}</td>
        <td>{{ o.order.get_status_display }}</td>
        <td>
            {% for i in o.order.items.all %}
            {{ i.product_name }}<br/>
            {% endfor %}
        </td>
        <td>{{ o.order.order_total }}&euro;</td>
    {% endfor %}
    </tbody>
    </table>
</div> <!-- widget-content -->
</div>
{% endblock %}
